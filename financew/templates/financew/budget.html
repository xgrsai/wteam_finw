{% extends 'financew/base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'styles.css' %}"> 

<p>{{ budget.name }} {{ budget.amount }} {{ budget.currency }} <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –±—é–¥–∂–µ—Ç—É -->
    <button id="edit-budget-btn">–ó–º—ñ–Ω–∏—Ç–∏ –¥–∞–Ω—ñ</button></p>

<!-- –§–æ—Ä–º–∞ –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –±—é–¥–∂–µ—Ç—É (—Å–ø–æ—á–∞—Ç–∫—É –ø—Ä–∏—Ö–æ–≤–∞–Ω–∞) -->
<div id="edit-budget-form" style="display: none;">
    <form method="post" action="{% url 'financew:budget' budget.id %}">
        {% csrf_token %}
        {{form.as_div}}
        
        {% comment %} <label for="name">–ù–∞–∑–≤–∞ –±—é–¥–∂–µ—Ç—É:</label>
        <input type="text" name="name" value="{{ budget.name }}" required>
        <label for="amount">–°—É–º–∞:</label>
        <input type="number" name="amount" value="{{ budget.amount }}" required>
        <label for="currency">–í–∞–ª—é—Ç–∞:</label>
        <input type="text" name="currency" value="{{ budget.currency }}" required> {% endcomment %}
        
        {% comment %} {% for fm in form %}
        <div class="form-group" style="border: 2px solid red; padding: 10px;">
            <label>{{fm.label}}</label>
            <div>{{fm}} </div>
        </div>
        {% endfor %}  {% endcomment %}


        <button type="submit">–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
        <button type="button" id="cancel-edit-btn">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </form>
</div>


<a href="{% url "financew:new_finoperation" budget.id %}">–î–æ–¥–∞—Ç–∏ –Ω–æ–≤—É —Ñ—ñ–Ω–∞–Ω—Å–æ–≤—É –æ–ø–µ—Ä–∞—Ü—ñ—é</a>
{% for finoperation in finoperations %}
<div style="display: flex; align-items: center; gap: 10px;">

    <!-- –í–∏–≤–µ–¥–µ–Ω–Ω—è —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ—ó –æ–ø–µ—Ä–∞—Ü—ñ—ó -->
    <span>{{ finoperation.get_type_display }} - {{ finoperation.amount }} - {{ finoperation.date_added }} - {{ finoperation.category }}</span>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ—ó –æ–ø–µ—Ä–∞—Ü—ñ—ó -->
    <a href="#" class="edit-finoperation-btn" data-finoperation-id="{{ finoperation.id }}" style="color: blue; text-decoration: none;">–ó–º—ñ–Ω–∏—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—é</a>

    <!-- –§–æ—Ä–º–∞ –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ—ó –æ–ø–µ—Ä–∞—Ü—ñ—ó (—Å–ø–æ—á–∞—Ç–∫—É –ø—Ä–∏—Ö–æ–≤–∞–Ω–∞) -->
    <div id="edit-finoperation-form-{{ finoperation.id }}" class="edit-finoperation-form" style="display: none;">
        <form method="POST" action="{% url 'financew:edit_finoperation' finoperation.id %}">
            {% csrf_token %}
            <input type="number" name="amount" value="{{ finoperation.amount }}" placeholder="–°—É–º–∞ –æ–ø–µ—Ä–∞—Ü—ñ—ó" required>
            <select name="type">
                <option value="expense" {% if finoperation.type == 'expense' %}selected{% endif %}>–í–∏—Ç—Ä–∞—Ç–∞</option>
                <option value="income" {% if finoperation.type == 'income' %}selected{% endif %}>–ü—Ä–∏–±—É—Ç–æ–∫</option>
            </select>
            <button type="submit" >–ó–º—ñ–Ω–∏—Ç–∏</button>
        </form>
    </div>

    <!-- –≤–∏–¥–∞–ª–µ–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ—ó -->
    <a href="{% url 'financew:delete_finoperation' finoperation.id %}" >üóë –í–∏–¥–∞–ª–∏—Ç–∏</a>
</div>


{% empty %}
<p>–ù–µ–º–∞ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π</p>
{% endfor %}



–¢—Ä–∞–Ω—Å—Ñ–µ—Ä–∏ –∑ –±—é–¥–∂–µ—Ç—É –≤ –±—é–¥–∂–µ—Ç:
{% comment %} –ö–Ω–æ–ø–∫–∏ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π {% endcomment %}


<table border="1">
    <thead>
        <tr>
            <th>–î–∞—Ç–∞</th>
            <th>–ó –±—é–¥–∂–µ—Ç—É</th>
            <th>–£ –±—é–¥–∂–µ—Ç</th>
            <th>–°—É–º–∞</th>
        </tr>
    </thead>
    <tbody>
        {% for transfer in transfers %}
        <tr>
            <td>{{ transfer.date_added }}</td>
            <td>{{ transfer.from_budget.name }}</td>
            <td>
                {% if transfer.to_budget %}
                    {{ transfer.to_budget.name }}
                    {% else %}
                    {{ transfer.to_goalbudget.name }}
                {% endif %}
            </td>
            <td>{{ transfer.amount }} {{ transfer.from_budget.currency }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="4">–ù–µ–º–∞—î –ø–µ—Ä–µ–∫–∞–∑—ñ–≤</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!--–§–æ—Ä–º–∞ –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—É –¥–æ –±—é–¥–∂–µ—Ç—É-->
<div>
<button id="add-budget-transfer">–ó–¥—ñ–π—Å–Ω–∏—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é –¥–æ –±—é–¥–∂–µ—Ç—É</button>
<div id = 'new-budget-transfer-form' style = "display:none;">
<form action="{% url 'financew:budget' budget.id %}" method="post">
    {%csrf_token%}
    {{transferbudgetform.as_div}}
    <button type="submit">–ó–¥—ñ–π—Å–Ω–∏—Ç–∏ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä</button>
    <button type="button" id="cancel-budget-transfer">–°–∫–∞—Å—É–≤–∞—Ç–∏</button> <!--type="button" - —â–æ–± –Ω–µ –¥—É–º–∞–ª–æ —â–æ —Ü–µ submit-->
</form>
</div>
</div>

<!--–§–æ—Ä–º–∞ –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—É –¥–æ –±—é–¥–∂–µ—Ç—É-—Ü—ñ–ª—ñ-->
<div>
<button id="add-goalbudget-transfer">–ó–¥—ñ–π—Å–Ω–∏—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é –¥–æ –±—é–¥–∂–µ—Ç—É-—Ü—ñ–ª—ñ</button>
<div id = 'new-goalbudget-transfer-form' style = "display:none;">
    <form action="{% url 'financew:budget' budget.id %}" method="post">
        {%csrf_token%}
        {{transfergoalbudgetform.as_div}}
        <button type="submit">–ó–¥—ñ–π—Å–Ω–∏—Ç–∏ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä</button>
        <button type="button" id="cancel-goalbudget-transfer">–°–∫–∞—Å—É–≤–∞—Ç–∏</button> <!--type="button" - —â–æ–± –Ω–µ –¥—É–º–∞–ª–æ —â–æ —Ü–µ submit-->
    </form>
    </div>
</div>

<script>
    // –û—Ç—Ä–∏–º—É—î–º–æ –µ–ª–µ–º–µ–Ω—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –¥–ª—è –±—é–¥–∂–µ—Ç—É
    const editBudgetBtn = document.getElementById("edit-budget-btn");
    const editBudgetForm = document.getElementById("edit-budget-form");
    const cancelEditBtn = document.getElementById("cancel-edit-btn");
    // –û—Ç—Ä–∏–º—É—î–º–æ –µ–ª–µ–º–µ–Ω—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—É –¥–æ –±—é–¥–∂–µ—Ç—É
    const newBudgetTransferBtn = document.getElementById("add-budget-transfer");
    const newBudgetTransferForm = document.getElementById("new-budget-transfer-form");
    const cancelBudgetTransferBtn = document.getElementById("cancel-budget-transfer");
    // –û—Ç—Ä–∏–º—É—î–º–æ –µ–ª–µ–º–µ–Ω—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—É –¥–æ –±—é–¥–∂–µ—Ç—É-—Ü—ñ–ª—ñ
    const newGoalBudgetTransferBtn = document.getElementById("add-goalbudget-transfer");
    const newGoalBudgetTransferForm = document.getElementById("new-goalbudget-transfer-form");
    const cancelGoalBudgetTransferBtn = document.getElementById("cancel-goalbudget-transfer");

    // –ü–æ–∫–∞–∑—É—î–º–æ —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –±—é–¥–∂–µ—Ç—É –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ó–º—ñ–Ω–∏—Ç–∏ –¥–∞–Ω—ñ"
    editBudgetBtn.addEventListener("click", function(event) {
        event.preventDefault();
        editBudgetForm.style.display = "block"; // –ü–æ–∫–∞–∑—É—î–º–æ —Ñ–æ—Ä–º—É
        editBudgetBtn.style.display = "none"; // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
    });
    // –°–∫–∞—Å—É–≤–∞—Ç–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –±—é–¥–∂–µ—Ç—É
    cancelEditBtn.addEventListener("click", function() {
        editBudgetForm.style.display = "none"; // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ —Ñ–æ—Ä–º—É
        editBudgetBtn.style.display = "inline"; // –ü–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
    });

    // –ü–æ–∫–∞–∑—É—î–º–æ —Ñ–æ—Ä–º—É –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—É –¥–æ –±—é–¥–∂–µ—Ç—É
    newBudgetTransferBtn.addEventListener("click", function(event) {
    event.preventDefault();
    newBudgetTransferForm.style.display = "block"; // –ü–æ–∫–∞–∑—É—î–º–æ —Ñ–æ—Ä–º—É
    newBudgetTransferBtn.style.display = "none"; // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
    });
    // –°–∫–∞—Å—É–≤–∞—Ç–∏ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä –¥–æ –±—é–¥–∂–µ—Ç—É
    cancelBudgetTransferBtn.addEventListener("click", function() {
    newBudgetTransferForm.style.display = "none"; // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ —Ñ–æ—Ä–º—É
    newBudgetTransferBtn.style.display = "inline"; // –ü–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
    });

    // –ü–æ–∫–∞–∑—É—î–º–æ —Ñ–æ—Ä–º—É –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—É –¥–æ –±—é–¥–∂–µ—Ç—É-—Ü—ñ–ª—ñ
    newGoalBudgetTransferBtn.addEventListener("click", function(event) {
    event.preventDefault();
    newGoalBudgetTransferForm.style.display = "block"; // –ü–æ–∫–∞–∑—É—î–º–æ —Ñ–æ—Ä–º—É
    newGoalBudgetTransferBtn.style.display = "none"; // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
    });
    // –°–∫–∞—Å—É–≤–∞—Ç–∏ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä –¥–æ –±—é–¥–∂–µ—Ç—É-—Ü—ñ–ª—ñ
    cancelGoalBudgetTransferBtn.addEventListener("click", function() {
    newGoalBudgetTransferForm.style.display = "none"; // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ —Ñ–æ—Ä–º—É
    newGoalBudgetTransferBtn.style.display = "inline"; // –ü–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
    });
    

    // –û—Ç—Ä–∏–º—É—î–º–æ –≤—Å—ñ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
    const editFinoperationBtns = document.querySelectorAll(".edit-finoperation-btn");
    editFinoperationBtns.forEach(function(button) {
        button.addEventListener("click", function(event) {
            event.preventDefault(); // —Ü–µ –±–ª–æ–∫—É—î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É –ø–æ–≤–µ–¥—ñ–Ω–∫—É —Ñ–æ—Ä–º–∏ (–±–µ–∑ –ø–µ—Ä–µ–Ω–∞–ø—Ä–≤–ª–µ–Ω—å) (–ø–æ—è—Å—Ç–µ–Ω–Ω—è –ß–ê–¢–ì–ü–¢ -  –±–ª–æ–∫—É—î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É –ø–æ–≤–µ–¥—ñ–Ω–∫—É –ø–æ–¥—ñ—ó, —Ç–æ–±—Ç–æ –≤—ñ–Ω –Ω–µ –¥–æ–∑–≤–æ–ª—è—î –±—Ä–∞—É–∑–µ—Ä—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ —Ñ–æ—Ä–º—É, –Ω–µ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î —Å—Ç–æ—Ä—ñ–Ω–∫—É —ñ –Ω–µ –≤–∏–∫–æ–Ω—É—î –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è, —è–∫–µ –∑–∞–∑–≤–∏—á–∞–π –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ –∫–Ω–æ–ø–∫—É –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è.)

            // –û—Ç—Ä–∏–º—É—î–º–æ ID —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ—ó –æ–ø–µ—Ä–∞—Ü—ñ—ó
            const finoperationId = button.getAttribute("data-finoperation-id");

            // –ó–Ω–∞—Ö–æ–¥–∏–º–æ —Ñ–æ—Ä–º—É –¥–ª—è —Ü—ñ—î—ó —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ—ó –æ–ø–µ—Ä–∞—Ü—ñ—ó
            const form = document.getElementById("edit-finoperation-form-" + finoperationId);

            // –ü–µ—Ä–µ–º–∏–∫–∞—î–º–æ –≤–∏–¥–∏–º—ñ—Å—Ç—å —Ñ–æ—Ä–º–∏
            if (form.style.display === "none") {
                form.style.display = "block";
            } else {
                form.style.display = "none";
            }
        });
    });
</script>

{% endblock content %}
