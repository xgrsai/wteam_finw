{% extends 'financew/base.html' %}
{% load static %}
{% block content %}


<div class="transactions-container">
    <div class="side-bar">
        <a  href="{% url 'financew:my' %}"><img src="{% static 'img/acc.svg' %}" alt="">Персональний кабінет</a>
        <!--Посилання ня на сторінку графіків-->
        <a href="{% url 'plots:report' %}"><img src="{% static 'img/grafik.svg' %}" alt="">  Візуалізація (чи звіти) </a>
        <!-- Посилання на сторінку всіх транзакцій -->
        <a style="background-color: #EAF1DF;"href="{% url 'financew:transactions' %}"> <img src="{% static 'img/euro.svg' %}" alt=""> Переглянути всі транзакції</a>
        <form method="get" action = {% url 'financew:transactions'%}>
            <p>{{currencydisplayform.as_div}}</p>
        </form>
        
    </div>
    
<div class="all-transactions">    
<h2>Усі транзакції</h2>

<!-- Форма для фільтрів -->
<form method="get">
    <label for="date">Дата:</label>
    <input type="date" name="date" id="date" value="{{ request.GET.date }}">

    <label for="budget">Бюджет:</label>
    <select name="budget" id="budget">
        <option value="">Всі</option>
        {% for budget in budgets %}
            <option value="{{ budget.id }}" {% if request.GET.budget == budget.id|stringformat:"s" %}selected{% endif %}>
                {{ budget.name }}
            </option>
        {% endfor %}
    </select>

    <label for="category">Категорія:</label>
    <select name="category" id="category">
        <option value="">Всі</option>
        {% for category in categories %}
            <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"s" %}selected{% endif %}>
                {{ category.name }}
            </option>
        {% endfor %}
    </select>

    <label for="type">Тип:</label>
    <select name="type" id="type">
        <option value="">Всі</option>
        <option value="income" {% if request.GET.type == "income" %}selected{% endif %}>Прибуток</option>
        <option value="expense" {% if request.GET.type == "expense" %}selected{% endif %}>Витрата</option>
    </select>

    <button type="submit">Фільтрувати</button>
    <a href="{% url 'financew:transactions' %}" class="reset-button">Скинути фільтри</a>
</form>

<h3>Список транзакцій</h3>
<ul>
{% for item in operations_with_converted %}
    <li style="color: {% if item.operation.type == 'income' %}green{% else %}red{% endif %};">
      {{ item.operation.date_added|date:"Y-m-d H:i" }} - 
      {{ item.operation.get_type_display }}:
      {{ item.converted_amount|floatformat:2 }} {{ display_currency }}
      (Бюджет: {{ item.operation.budget.name }}{% if item.operation.category %}, Категорія: {{ item.operation.category.name }}{% endif %})
    </li>
{% empty %}
    <li>Транзакції не знайдено</li>
{% endfor %}
</ul>
</div>

</div>
<style>
    .reset-button {
        display: inline-block;
        padding: 5px 10px;
        margin-left: 10px;
        background-color: #ccc;
        color: black;
        text-decoration: none;
        border-radius: 5px;
    }
    .reset-button:hover {
        background-color: #bbb;
    }
</style>

{% endblock content %}
