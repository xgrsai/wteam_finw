{% extends 'financew/base.html' %}
{% block content %}
{% for budget in budgets %}<!-- воно бере по назві ключа -->
  <li>
    <a href="{% url 'financew:budget' budget.id %}">{{ budget.name }} {{ budget.amount }} {{ budget.currency }}</a>
  </li> 
  {% empty %}
  <li>Бюджети не знайдено</li>
  {% endfor %}
  <!-- Кнопка для додавання нового бюджету -->
<button id="add-budget-btn">Додати новий бюджет</button>

<!-- Форма для додавання нового бюджету (спочатку прихована) -->
<div id="add-budget-form" style="display: none;">
  <form action="{% url 'financew:my' %}" method="post"> <!-- action - куди відправляється форма-->
    {% csrf_token %} <!--токен CSRF, який додається до кожної форми, що дозволяє серверу перевіряти, чи запит дійсно надійшов з авторизованого джерела (тобто з вашого веб-сайту, а не з якогось іншого, створеного зловмисником).-->
    {{ form.as_div }}
    <button name="submit">Додати бюджет</button>
    <button id="cancel-btn">Скасувати</button>
  </form> </div>

  

 <!-- Кнопка для додавання категорії -->
<button id="show-category-form-btn">Додати категорію</button>

<!-- Форма для введення нової категорії (спочатку прихована) -->
<div id="add-category-form" style="display: none; margin-top: 10px;">
    <form id="category-form">
        {% csrf_token %}
        <input type="text" id="category-name" placeholder="Введіть назву категорії" required>
        <button type="submit">Додати</button>
        <button type="button" id="cancel-category-btn">Скасувати</button>
    </form>
</div>

<script>
document.getElementById("show-category-form-btn").addEventListener("click", function() {
    document.getElementById("add-category-form").style.display = "block";  // Показати форму
    document.getElementById("show-category-form-btn").style.display = "none";  // Сховати кнопку
});

document.getElementById("cancel-category-btn").addEventListener("click", function() {
    document.getElementById("add-category-form").style.display = "none";  // Сховати форму
    document.getElementById("show-category-form-btn").style.display = "block";  // Повернути кнопку
});

// Обробник подачі форми
document.getElementById("category-form").addEventListener("submit", function(event) {
    event.preventDefault();  // Відмінити перезавантаження сторінки

    const categoryName = document.getElementById("category-name").value;
    const csrfToken = document.querySelector("input[name='csrfmiddlewaretoken']").value;

    fetch("{% url 'financew:add_category' %}", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": csrfToken
        },
        body: JSON.stringify({ name: categoryName })
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message);
        if (data.message === "Категорію додано успішно!") {
            document.getElementById("category-form").reset();  // Очистити поле вводу
            document.getElementById("add-category-form").style.display = "none";  // Сховати форму
            document.getElementById("show-category-form-btn").style.display = "block";  // Повернути кнопку
        }
    })
    .catch(error => console.error("Помилка:", error));
});
</script>

  

  <script>
    // Отримуємо елементи
    const addBudgetBtn = document.getElementById("add-budget-btn");
    const addBudgetForm = document.getElementById("add-budget-form");
    const cancelBtn = document.getElementById("cancel-btn");

    // Показуємо форму для додавання бюджету
    addBudgetBtn.addEventListener("click", function(event) {
        event.preventDefault();
        addBudgetForm.style.display = "block"; // Показуємо форму
        addBudgetBtn.style.display = "none"; // Приховуємо кнопку додавання
    });

    // Скасувати додавання бюджету
    cancelBtn.addEventListener("click", function() {
        addBudgetForm.style.display = "none"; // Приховуємо форму
        addBudgetBtn.style.display = "inline"; // Показуємо кнопку додавання
    });
</script>

{% endblock content %}